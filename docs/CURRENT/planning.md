# Planning Document - Claude-Ops 완료 알림 시스템 개선

**Generated**: 2025-08-25 17:48:00
**Session**: claude_claude-ops  
**Workflow**: 전체사이클 - 기획 단계

## 🎯 프로젝트 개요

### 배경
Claude-Ops의 `/summary` 명령어에서 완료된 세션이 "대기중 0초"로 표시되어 마치 진행 중인 것처럼 보이는 문제 발생. 특히 `claude_claude_share_snack_tier_preference_vote` 세션이 완료되었음에도 대기시간이 0초로 표시됨.

### 목표  
100% 신뢰할 수 있는 세션 완료 감지 및 사용자 친화적 상태 표시 시스템 구축

## 📊 As-Is/To-Be/Gap 분석

| 영역 | 현재 상태 | 목표 상태 | 격차 | 우선순위 |
|------|-----------|-----------|------|----------|
| 완료 감지률 | ~90% (일부 누락) | 99.9% | Hook 안정성 + Fallback | 🔴 HIGH |
| 상태 표시 | 혼란스러운 0초 | 명확한 구분 | 로직 개선 | 🔴 HIGH |
| 사용자 경험 | 기술적 혼동 | 직관적 이해 | UX 개선 | 🟡 MEDIUM |
| 시스템 복원성 | 단일점 실패 | 다중 안전장치 | 아키텍처 강화 | 🟡 MEDIUM |

## 🏗️ MECE 기반 작업분해(WBS)

### A. Hook 시스템 안정화 🔴 HIGH
- **A1**: 현재 Hook 설정 진단 및 검증
- **A2**: Hook 실행 로그 분석 시스템 구축  
- **A3**: Hook 실패 시 자동 재시도 메커니즘
- **A4**: Hook 상태 모니터링 대시보드

### B. Fallback 메커니즘 구현 🔴 HIGH  
- **B1**: 세션 생성 시간 기반 대기시간 계산
- **B2**: 완료 기록 누락 시 추정 알고리즘
- **B3**: 다중 데이터 소스 통합 로직
- **B4**: Fallback 사용 시 사용자 알림

### C. 상태 표시 로직 개선 🔴 HIGH
- **C1**: "알 수 없음" vs "0초" 구분 표시
- **C2**: 완료 감지 방법 투명성 제공
- **C3**: 사용자 친화적 메시지 템플릿  
- **C4**: Summary 명령어 UX 향상

### D. 시스템 모니터링 강화 🟡 MEDIUM
- **D1**: 완료 감지 성공률 메트릭 수집
- **D2**: 성능 벤치마크 및 알럿 시스템
- **D3**: 자동 진단 및 복구 시스템
- **D4**: 사용자 피드백 수집 메커니즘

## 👥 핵심 사용자 스토리

**US-1**: 정확한 대기시간 확인
- 사용자가 `/summary`를 실행했을 때, 모든 세션의 정확한 대기시간을 확인할 수 있다
- **AC1**: 완료된 세션은 실제 완료 후 경과시간 표시
- **AC2**: 완료 기록 누락 시 "추정" 또는 "알 수 없음" 명시
- **AC3**: 진행 중인 세션은 명확히"작업 중" 표시

**US-2**: 합리적인 Fallback 대기시간 
- 시스템이 완료 시점을 놓쳤을 때도 합리적인 대기시간을 제공받는다
- **AC1**: 세션 생성 시간 기반 Fallback 계산
- **AC2**: Fallback 사용 시 사용자에게 투명하게 알림  
- **AC3**: 99.5% 이상의 경우에서 ±1시간 내 정확도

## 📊 성공 기준

### 정량적 지표
- ✅ **완료 감지률**: 99.9% (현재 ~90%)
- ✅ **정확도**: 실제 대기시간 ±5분 이내
- ✅ **응답시간**: `/summary` 명령어 2초 이내
- ✅ **가용성**: 24/7 모니터링 중단 없음

### 정성적 지표  
- ✅ 사용자가 세션 상태를 명확히 이해
- ✅ "진행 중처럼 보이는" 완료 세션 제거
- ✅ Hook 실패 시에도 합리적인 정보 제공

## 🎯 우선순위 매트릭스

| 작업 | 중요도 | 긴급도 | 우선순위 | 예상공수 |
|------|--------|--------|----------|----------|
| Hook 시스템 진단 | High | High | 1 | 2시간 |
| Fallback 메커니즘 | High | High | 2 | 4시간 |
| 상태 표시 개선 | High | Medium | 3 | 3시간 |
| 모니터링 강화 | Medium | Low | 4 | 6시간 |

## 💡 기술적 접근 방식

### 핵심 설계 원칙
1. **Fail-Safe**: Hook 실패해도 서비스 지속
2. **투명성**: 사용자가 시스템 동작 이해 가능
3. **점진적 개선**: 기존 시스템 중단 최소화
4. **데이터 일관성**: 다중 소스 간 동기화 보장

### 기술 스택
- **Language**: Python 3.11+
- **Framework**: python-telegram-bot
- **Storage**: JSON 파일 + tmux 메타데이터
- **Monitoring**: 자체 구현 메트릭 시스템

## 📅 실행 계획

### Phase 1: 진단 및 분석 (1-2시간)
- Hook 시스템 현재 상태 정밀 진단
- 완료 감지 실패 패턴 분석
- 기존 코드 구조 리뷰

### Phase 2: 핵심 기능 구현 (3-4시간)  
- Fallback 메커니즘 구현
- 상태 표시 로직 개선
- 단위 테스트 작성

### Phase 3: 통합 및 검증 (2-3시간)
- 전체 시스템 통합 테스트
- 실제 세션으로 동작 검증  
- 성능 및 안정성 확인

### Phase 4: 배포 및 모니터링 (1시간)
- 프로덕션 배포
- 실시간 모니터링 설정
- 사용자 피드백 수집

## 🎉 예상 결과물

1. **안정적인 완료 감지**: 99.9% 신뢰성 달성
2. **명확한 상태 표시**: 혼동 없는 UX 제공  
3. **강화된 복원성**: 단일점 실패 제거
4. **투명한 시스템**: 사용자가 이해할 수 있는 동작

---
**Next Steps**: 구현 단계로 진행 → Hook 시스템 진단부터 시작