# "Hook 미설정으로 시간 추정" 경고 메시지 분석

## 📅 분석 정보
- **날짜**: 2025-01-14 18:30
- **요청**: "⚠️ _추정_ 표시: Hook 미설정으로 7개 세션 시간 추정 이게 무슨말이야?"
- **유형**: warning-message-clarification

## 📊 경고 메시지 의미

### 표시되는 메시지
```
⚠️ _추정_ 표시: Hook 미설정으로 7개 세션 시간 추정
```

### 실제 의미
**"Hook 미설정"은 잘못된 표현입니다.** 실제로는 다음을 의미합니다:
- **알림 기록 없음**: 해당 세션들에 대한 완료 알림 기록이 `completion_times.json`에 없음
- **추정 시간 사용**: 정확한 알림 시간 대신 tmux 세션 생성 시간 기반으로 추정

## 🔍 근본 원인

### 1. 잘못된 메시지 텍스트 (session_summary.py:472)
```python
if fallback_count > 0:
    message += f"⚠️ \\_추정\\_ 표시: Hook 미설정으로 {fallback_count}개 세션 시간 추정\n\n"
```

**문제점**: "Hook 미설정"이라는 표현이 사용자에게 혼란을 줌
- Hook과는 전혀 관련이 없음
- 실제로는 알림 기록이 없어서 추정치를 사용한다는 의미

### 2. 알림 기록이 없는 이유들

#### A. 새로운 세션
- 최근 생성된 세션으로 아직 완료 알림이 발생하지 않음

#### B. 세션 이름 변경
- tmux 세션 재생성 시 접미사 변경 (-1 → -2)
- 방금 구현한 정규화가 일부 해결하지만, 완전히 새로운 이름의 세션은 여전히 문제

#### C. 시스템 재시작
- claude-ops 재시작 시 일부 기록이 초기화될 수 있음
- `/tmp/claude_completion_times.json` 파일이 비워지거나 수정됨

#### D. 알림 미발생
- 세션이 계속 작업 중이어서 완료 알림이 한 번도 발생하지 않음

## 💡 해결 방안

### 1. 즉시 수정 (메시지 텍스트 개선)
```python
# Before
message += f"⚠️ \\_추정\\_ 표시: Hook 미설정으로 {fallback_count}개 세션 시간 추정\n\n"

# After (개선안)
message += f"ℹ️ 알림 기록이 없는 {fallback_count}개 세션은 생성 시간 기준 추정값 표시\n\n"
```

### 2. 사용자 친화적 메시지 옵션들
```python
# 옵션 1: 간단 명료
message += f"ℹ️ {fallback_count}개 세션: 첫 알림 대기 중 (추정 시간 표시)\n\n"

# 옵션 2: 상세 설명
message += f"📝 참고: {fallback_count}개 세션은 알림 이력이 없어 추정 시간 표시됨\n\n"

# 옵션 3: 기술적 설명 제거
message += f"💭 {fallback_count}개 세션은 대략적인 대기 시간 표시\n\n"
```

## 🎯 권장 조치

### P0: 메시지 텍스트 수정
1. "Hook 미설정" → "알림 기록 없음"으로 변경
2. 사용자가 이해하기 쉬운 표현 사용

### P1: 추정 정확도 개선
1. 세션 이름 정규화 (이미 완료 ✅)
2. 세션 상태 변경 시점 추적 강화

### P2: 문서화
1. FAQ에 추정 시간의 의미 설명 추가
2. 정확한 시간을 위한 조건 안내

## 📈 영향 분석

### 현재 상황
- 9개 활성 세션 중 7개가 추정 시간 표시
- 사용자에게 "Hook 미설정"이라는 혼란스러운 메시지 표시

### 개선 후
- 명확한 메시지로 사용자 혼란 해소
- 추정값임을 인지하고 적절히 대응 가능

## ✅ 결론

**"Hook 미설정"은 잘못된 표현입니다.**

실제 의미:
1. 해당 세션들에 대한 완료 알림 기록이 없음
2. tmux 세션 생성 시간을 기준으로 대기 시간을 추정
3. Hook 시스템과는 무관

**즉시 조치 필요**: 메시지 텍스트를 사용자가 이해하기 쉬운 표현으로 수정

## 🔗 관련 파일
- `claude_ops/utils/session_summary.py:472` - 경고 메시지 출력 부분
- `claude_ops/utils/wait_time_tracker.py:216-241` - has_completion_record() 메서드
- `/tmp/claude_completion_times.json` - 알림 시간 저장 파일